<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <link rel="manifest" href="manifest.json">
  <title>Cash-Style Pay Screen (Mobile)</title>
  <style>
    :root{
      --bg:rgba(255,255,255,0.9);
      --text:#0b0b0f; --muted:#9aa0a6; --line:#ececec;
      --green:#22c55e; --cash:#12c46f; --shadow:0 8px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; 
      /* Changed font stack to better match the typical mobile UI font/weight structure */
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:#ffffff; 
    }

    /* MOBILE-FIRST: full-bleed, starts at the top, fits screen */
    .phone{
      width:100%; height:100dvh; 
      background:var(--bg);
      overflow:auto; 
      padding-top:calc( env(safe-area-inset-top) + 0px );
      -webkit-overflow-scrolling:touch;
    }

    .header{
      position:sticky;top:0;
      background:rgba(255,255,255,0.86);
      backdrop-filter:saturate(180%) blur(12px);
      display:flex;align-items:center;justify-content:space-between;
      padding:18px 16px 10px 16px;
      border-bottom:1px solid var(--line);
      z-index:10;
    }
    .header .close{width:22px;height:22px;display:grid;place-items:center;border-radius:10px;cursor:pointer}
    .header .amount{
      font-size:26px;
      font-weight:700; /* Matched amount weight */
      letter-spacing:.3px
    }
    .pay-btn{
      background:#ccead7;color:#065f46;border:none;padding:8px 16px; /* Slightly smaller padding */
      border-radius:999px;font-weight:800;cursor:pointer;transition:.2s ease;opacity:.4;pointer-events:none;
      font-size: 15px; /* Matched button text size */
    }
    .pay-btn.active{background:#22c55e;color:#fff;opacity:1;pointer-events:auto}

    .form{padding:6px 16px 2px 16px}
    .row{display:flex;align-items:center;gap:10px;padding:12px 0}
    .row + .row{border-top:1px solid var(--line)}
    .label{
      width:38px;
      color:var(--muted);
      font-weight:600; /* Slightly lower weight for "To" / "For" labels */
      font-size:14px
    }
    .field{flex:1}
    .input{
      width:100%;border:none;outline:none;background:transparent;
      font-size:16px;
      font-weight: 500; /* Default input text weight */
      color:#111
    }
    .req{color:#c0c4c9}
    
    /* MODIFIED: Addon styles updated for a cleaner, more Cash App-like button */
    .addon{
        width:32px; /* Slightly smaller */
        height:32px;
        border-radius:10px; /* Sharper radius */
        display:grid;
        place-items:center;
        background:#f3f3f3; /* Lighter background */
        color:#444; /* Darker, higher contrast text color */
        font-size: 16px; /* Slightly larger text */
        font-weight: 800;
        letter-spacing: -0.5px;
        cursor: pointer;
    }

    .use-balance{display:flex;align-items:center;gap:10px;padding:14px 16px;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
    .cash-icon{width:24px;height:24px;border-radius:8px;background:var(--cash);display:grid;place-items:center;color:white;font-weight:900}
    .caret{margin-left:auto;opacity:.6}

    .section-head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px 6px 16px}
    .section-title{font-weight:800;font-size:18px}
    .use-suggested{border:none;background:transparent;color:#6b7280;font-weight:700;border-radius:999px;padding:8px 10px;cursor:pointer}

    .list{padding:0 6px 18px 6px}
    .item{
        display:flex;
        align-items:center;
        gap:12px;
        padding:12px 10px;
        border-radius:14px;
        cursor:pointer;
        transition:background .2s ease
    }
    .item:hover{background:#f2f2f2}
    
    .avatar{width:44px;height:44px;border-radius:50%;background:#ddd;object-fit:cover}
    
    .meta{flex:1;min-width:0} 
    /* MODIFIED: Font weights for name and cashtag */
    .name{
        font-weight: 600; /* Name is semi-bold */
        color: #111;
    }
    .cashtag{
        font-weight: 400; /* Cashtag is regular weight */
        font-size: 14px;
        color: var(--muted);
        margin-top: 1px;
    }
    
    /* Styling for the initial-based avatars */
    .avatar-initials {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: 800;
        color: white;
    }
    
    /* Checkbox styles for better visual match */
    .check{
        width:24px;
        height:24px;
        border:2px solid #b5b5b5; 
        border-radius:8px; 
        display:grid;place-items:center;cursor:pointer;transition:.15s;background:#fff
    }
    .check.checked{border-color:var(--green);background:var(--green)}
    .check.checked::after{
        content:"";
        width: 6px; 
        height: 12px; 
        transform:rotate(45deg);
        border-right:2px solid white;
        border-bottom:2px solid white;
        margin-top:-2px;
    }
    .divider{height:1px;background:var(--line);margin:6px 0}

    /* DESKTOP/TABLET: center the translucent card with backdrop */
    @media (min-width: 640px){
      body{background:linear-gradient(135deg,#e9f4ee,#fafafa);display:flex;justify-content:center;align-items:flex-start}
      .phone{max-width:420px;height:calc(100dvh - 40px);margin:20px;border-radius:28px;box-shadow:0 10px 40px rgba(0,0,0,.1);backdrop-filter:blur(20px);}
    }

    /* Page slide-in animation (bottom to top) */
@keyframes slideIn {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

body {
  animation: slideIn 0.5s ease both;
}

  </style>
</head>
<body>
  <div class="phone">
    <header class="header">
      <div class="close" title="Close" aria-label="Close">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </div>
      <div class="amount" id="displayAmount">$0</div>
      <button class="pay-btn" aria-label="Pay">Pay</button>
    </header>

    <section class="form">
      <div class="row">
        <div class="label">To</div>
        <div class="field">
          <input class="input" placeholder="Name, $Cashtag, Phone, Email" aria-label="Recipient" />
        </div>
      </div>
     <div class="row">
        <div class="label">For</div>
        <div class="field">
            <input class="input" id="noteInput" placeholder="Note (required)" />
        </div>
        <div class="addon">
            ++
        </div>
     </div>

    </section>

    <div class="use-balance">
      <div class="cash-icon">$</div>
      <div style="font-weight:700">Use</div>
      <div style="margin-left:6px;color:#6f7782">Cash balance: <span style="color:#111;font-weight:700">$33,846.00</span></div>
      <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
    </div>

    <div class="section-head">
      <div class="section-title">Suggested</div>
      <button class="use-suggested" id="useSuggested">Use suggested</button>
    </div>

    <section class="list" id="suggested"></section>
  </div>
  
  <div id="faceIdOverlay" aria-live="polite" aria-busy="true" style="display:none">
  <div class="faceid-backdrop" role="presentation"></div>
  <div class="faceid-card" role="dialog" aria-label="Face ID approval">
    <div class="faceid-circle">
      <svg class="faceid-face" viewBox="0 0 64 64" aria-hidden="true">
        <g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10 18v-4a4 4 0 0 1 4-4h4" />
          <path d="M50 10h4a4 4 0 0 1 4 4v4" />
          <path d="M58 46v4a4 4 0 0 1-4 4h-4" />
          <path d="M18 54h-4a4 4 0 0 1-4-4v-4" />
          <path d="M24 28h0" />
          <path d="M40 28h0" />
          <path d="M24 40c8 6 16 0 16 0" />
          <rect x="16" y="16" width="32" height="32" rx="10" />
        </g>
      </svg>

      <div class="faceid-scan"></div>

      <svg class="faceid-tick" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <div class="faceid-text" id="faceIdText">Face ID</div>
  </div>
</div>

<style>
  :root {
    --green: #22c55e;
  }

  #faceIdOverlay {
    position: fixed; inset: 0; z-index: 9999;
  }
  .faceid-backdrop {
    position: absolute; inset: 0; background: rgba(0,0,0,.75);
  }
  .faceid-card {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff; border-radius: 18px;
    padding: 22px 24px; width: 260px;
    box-shadow: 0 18px 44px rgba(0,0,0,.25);
    display: grid; justify-items: center; gap: 14px;
  }
  .faceid-circle {
    position: relative;
    width: 120px; height: 120px;
    border-radius: 999px;
    border: 3px solid rgba(34,197,94,.25);
    display: grid; place-items: center;
    overflow: hidden;
  }
  .faceid-face {
    width: 76px; height: 76px;
    color: rgba(34,197,94,.9);
    opacity: .95;
  }
  .faceid-scan {
    position: absolute; left: 0; right: 0; height: 18px;
    background: linear-gradient(90deg,
      rgba(34,197,94,0) 0%,
      rgba(34,197,94,.15) 40%,
      rgba(34,197,94,.25) 50%,
      rgba(34,197,94,.15) 60%,
      rgba(34,197,94,0) 100%);
    top: -18px;
    animation: face-scan 1.5s ease-in-out 1 forwards;
  }
  @keyframes face-scan {
    0% { top: -18px; }
    50% { top: 51px; }
    100% { top: 138px; }
  }
  .faceid-tick {
    position: absolute; width: 64px; height: 64px;
    color: var(--green);
    opacity: 0; transform: scale(.6);
    transition: opacity .25s ease, transform .25s ease;
  }
  /* success state */
  .ok .faceid-scan { display: none; }
  .ok .faceid-tick { opacity: 1; transform: scale(1); }
  .faceid-text {
    font-weight: 800; color: #111; letter-spacing: .2px;
  }
  .ok + .faceid-text,
  .ok ~ .faceid-text {
    color: var(--green);
  }
</style>


 <script>
  // Color palette for ad-hoc initials to ensure variety
  const initialColors = [
    '#5cb85c', '#428bca', '#f77348', '#d9534f', '#5bc0de', '#f0ad4e', 
    '#795548', '#673ab7', '#009688', '#e91e63'
  ];
  let colorIndex = 0;
  function getNextColor() {
    const color = initialColors[colorIndex % initialColors.length];
    colorIndex++;
    return color;
  }
  
  // Existing contacts (some with fixed colors)
  const basePeople = [
    { name: 'sinz Vaesau', handle: '$sinavvs', type: 'photo' },
    { name: 'Mariah H', handle: '$RiahhBabyy', type: 'initial', color: '#f77348' }, // Orange
    { name: 'Sarah Lee', handle: '$Famlee885', type: 'photo' },
    { name: 'Marisa Perez', handle: '$mrisa08', type: 'photo' },
    { name: 'Qwuanell', handle: '$s3rvex1n', type: 'photo' },
    { name: 'Darien Levario', handle: '$darienr6', type: 'initial', color: '#d9534f' } // Red
  ];

  function uniqueRandom(count, max){
    const set = new Set();
    while(set.size < count){ set.add(1 + Math.floor(Math.random()*max)); }
    return [...set];
  }

  // Logic to generate different/random photo avatars and consistent initial-like avatars
  const people = basePeople.map((p, i) => {
    let avatarUrl;
    if (p.type === 'initial') {
      avatarUrl = null; 
    } else {
      // Use a timestamp and random ID for photo people to ensure a fresh, different avatar each time.
      const randomId = Math.floor(Math.random() * 999999);
      // Ensures i.pravatar is used and changes every time
      avatarUrl = `https://i.pravatar.cc/100?img=${i + 1}&u=${Date.now()}-${randomId}`; 
    }
    
    return {
      ...p,
      avatar: avatarUrl
    };
  });
  // END MODIFICATION

  const list   = document.getElementById('suggested');
  const payBtn = document.querySelector('.pay-btn');
  const input  = document.querySelector('.input');

  // Track which items are checked so we can preserve selection across re-renders
  const selectedHandles = new Set();

  function normalize(s){
    return (s || '')
      .toLowerCase()
      .replace(/\s+/g,'')
      .replace(/^\$/,''); // ignore leading $ in handles
  }

  function scorePerson(person, qNorm){
    const n = normalize(person.name);
    const h = normalize(person.handle);
    if (!qNorm) return 0;
    if (n === qNorm || h === qNorm) return 3;       // exact match
    if (n.startsWith(qNorm) || h.startsWith(qNorm)) return 2; // prefix
    if (n.includes(qNorm) || h.includes(qNorm)) return 1;     // substring
    return 0;
  }

  // Function to create an ad-hoc person from a name/query
  function slugify(s){
    return (s || '')
      .toLowerCase()
      .replace(/^\$/,'')        // ignore a leading $
      .replace(/[^a-z0-9]+/g,'')// keep letters/numbers
      .slice(0,20);             // keep things tidy
  }

  // MODIFIED: Generates ad-hoc person with different types and colors
  function makeAdHocPerson(query){
    const name = query.trim();
    const base = slugify(name);
    let handle = '$' + (base || 'user');
    
    const isCashtag = name.startsWith('$');

    // ensure unique handle vs existing people
    const taken = new Set(people.map(p => p.handle));
    let n = 1;
    while (taken.has(handle)) { handle = `$${base}${n++}`; }
    
    // Use the name entered as the display name, stripping leading $ for non-handle view
    const displayName = isCashtag ? name.substring(1).trim() : name;
    
    if (isCashtag) {
      // MODIFIED: Assign a rotating color for cashtags
      return {
        name: displayName,
        handle: name, // Use the full cashtag as the handle
        type: 'cashtag',
        color: getNextColor() // <-- Assign rotating color here
      };
    } else {
      // General name, use rotating colored initial avatar
      return {
        name: displayName,
        handle: handle,
        type: 'ad-hoc-initial',
        color: getNextColor() 
      };
    }
  }

  function exactMatchExists(qNorm){
    return people.some(p => {
      const n = normalize(p.name);
      const h = normalize(p.handle);
      return qNorm && (n === qNorm || h === qNorm);
    });
  }
  
  // getOrderedPeople function to handle comma-separated input
  function getOrderedPeople(query){
    // Reset color index for a consistent color display on each new input (optional)
    colorIndex = 0; 
    
    const q = (query || '').trim();
    const qNorm = normalize(q);

    // 1. Check for comma-separated input
    if (q.includes(',')) {
        const names = q.split(',').map(n => n.trim()).filter(n => n.length > 0);
        
        // Create an ad-hoc person for each name
        const multiSuggestions = names.map(name => {
            const adHoc = makeAdHocPerson(name);
            // Preserve its checked state if user already selected it earlier
            if (selectedHandles.has(adHoc.handle)) { /* no-op; state is in Set */ }
            return adHoc;
        });

        // Show the multi-names on top, followed by the existing list
        return [...multiSuggestions, ...people];
    }
    
    // 2. Handle single-name/cashtag search (original logic)
    const ordered = [...people].sort((a, b) => {
      const sa = scorePerson(a, qNorm);
      const sb = scorePerson(b, qNorm);
      if (sa !== sb) return sb - sa;
      return a.name.localeCompare(b.name);
    });

    // If user typed something AND it isn't an exact match,
    // add a top "ad-hoc" suggestion using what they typed.
    if (qNorm && !exactMatchExists(qNorm)) {
      const adHoc = makeAdHocPerson(q);
      // Preserve its checked state if user already selected it earlier
      if (selectedHandles.has(adHoc.handle)) { /* no-op; state is in Set */ }
      return [adHoc, ...ordered];
    }
    
    // Default: just the sorted list of people
    return ordered;
  }

  // MODIFIED: Updated renderList to handle 'ad-hoc-initial' and 'cashtag'
  function renderList(data = people){
    list.innerHTML = '';
    data.forEach((p, idx) => {
      const item = document.createElement('div'); 
      item.className = 'item';
      
      let av;
      
      if (p.type === 'initial' || p.type === 'ad-hoc-initial') {
        // Avatars for initials (existing or ad-hoc names)
        av = document.createElement('div');
        av.className = 'avatar avatar-initials'; 
        av.textContent = p.name.charAt(0).toUpperCase(); 
        if (p.color) {
            av.style.backgroundColor = p.color; 
        } else {
            // Fallback for existing initial contacts if color was missed
            av.style.backgroundColor = '#666'; 
        }
      } else if (p.type === 'cashtag') { 
        // MODIFIED: Avatars for cashtags ($ in input) - using rotating color
        av = document.createElement('div');
        av.className = 'avatar avatar-initials'; // Use generic initials class
        av.textContent = '$'; 
        if (p.color) {
            av.style.backgroundColor = p.color; // Apply rotating color
        }
        // Custom font size for the $ symbol
        av.style.fontSize = '24px';
      } else {
        // Use <img> for 'photo' avatars (only existing contacts now)
        av = document.createElement('img');
        av.className = 'avatar'; 
        av.src = p.avatar; 
        av.alt = p.name;
      }
      
      const meta = document.createElement('div'); 
      meta.className = 'meta'; // flex: 1 ensures the checkbox aligns right
      const n    = document.createElement('div'); n.className = 'name'; n.textContent = p.name;
      const t    = document.createElement('div'); t.className = 'cashtag'; t.textContent = p.handle;
      meta.append(n, t);

      const check = document.createElement('div'); check.className = 'check';
      // Use p.handle for tracking, which is the unique $cashtag or generated one
      const handleToTrack = p.type === 'cashtag' ? p.handle : p.handle; 
      
      if (selectedHandles.has(handleToTrack)) check.classList.add('checked');

      item.append(av, meta, check);
      list.append(item);
      if (idx < data.length - 1){
        const d = document.createElement('div'); d.className = 'divider'; list.append(d);
      }

      item.addEventListener('click', () => {
        check.classList.toggle('checked');
        if (check.classList.contains('checked')) selectedHandles.add(handleToTrack);
        else selectedHandles.delete(handleToTrack);
        updatePayState();
        
        // ðŸ’¾ Save selected user to localStorage
        localStorage.setItem('selectedName', p.name);
        localStorage.setItem('selectedHandle', handleToTrack);

        // âœ… Redirect to comp.html
        // window.location.href = 'comp.html'; // Disabled to prevent immediate navigation on click
      });
    });
  }

  function updatePayState(){
    const anySelected = selectedHandles.size > 0;
    if (anySelected){ payBtn.classList.add('active'); }
    else { payBtn.classList.remove('active'); }
  }

  // Initial render
  renderList();

  // â€œUse suggestedâ€ still checks everything currently visible
  document.getElementById('useSuggested').addEventListener('click', () => {
    const current = getOrderedPeople(input.value);
    current.forEach(p => {
        const handleToTrack = p.type === 'cashtag' ? p.handle : p.handle;
        selectedHandles.add(handleToTrack);
    });
    renderList(current);
    updatePayState();
  });

  // â­ Reorder suggestions as the user types
  input.addEventListener('input', (e) => {
    const ordered = getOrderedPeople(e.target.value);
    renderList(ordered);
  });
</script>
<script>
  // Get saved amount from localStorage
  const savedAmount = localStorage.getItem('paymentAmount');
  if (savedAmount) {
    document.getElementById('displayAmount').textContent = savedAmount;
  }
</script>

<script>
  (function () {
    const payBtn = document.querySelector('.pay-btn');
    const inputField = document.querySelector('.input');
    const amountEl = document.getElementById('displayAmount');

    // Face ID overlay elements
    const overlay = document.getElementById('faceIdOverlay');
    const circle  = overlay.querySelector('.faceid-circle');
    const textEl  = document.getElementById('faceIdText');

    function showFaceId() {
      // lock background scroll while visible
      document.body.style.overflow = 'hidden';
      overlay.style.display = 'block';

      // Reset state (in case of back nav)
      circle.classList.remove('ok');
      textEl.textContent = 'Face ID';

      // Run 1st scan pass (~1.5s), then show tick (~0.8s), then go
      setTimeout(() => {
        circle.classList.add('ok');
        textEl.textContent = 'Approved';
        setTimeout(() => {
          window.location.href = 'comp.html';
        }, 800);
      }, 1500);
    }

    function persistSelection() {
      // typed recipient
      const typedName = (inputField?.value || '').trim();
      if (typedName) localStorage.setItem('selectedName', typedName);

      // selected from suggestions
      try {
        const selectedHandle = Array.from((window.selectedHandles || new Set()))[0];
        const selectedPerson = (window.people || []).find(p => p.handle === selectedHandle);
        if (selectedPerson) {
          localStorage.setItem('selectedName', selectedPerson.name);
          localStorage.setItem('selectedHandle', selectedPerson.handle);
        }
      } catch {}

      // amount from header
      const amountText = amountEl?.textContent || '$500';
      localStorage.setItem('paymentAmount', amountText);
    }

    payBtn.addEventListener('click', () => {
      persistSelection();
      showFaceId();
    });

    // If user returns to this page, ensure overlay is hidden and scrolling restored
    window.addEventListener('pageshow', () => {
      overlay.style.display = 'none';
      document.body.style.overflow = '';
    });
  })();
</script>
</body>
</html>